name: pr
on:
  push:
    branches: [dev]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout latest code
        uses: actions/checkout@v1
      - name: Set up JDK 8
        uses: actions/setup-java@v2
        with:
          java-version: '8'
          distribution: 'adopt'
      - name: Make gradlew executable
        run: chmod +x ./gradlew
      - name: test
        run: ./gradlew test
      - name: Generate Keystore
        env:
          KEYSTORE: ${{secrets.SIGN_KEY}}
        run: |
          mkdir .keys
          echo $KEYSTORE | base64 --decode > .keys/h300s.keystore
      - name: Generate keystore.properties
        env:
          MYAPP_RELEASE_STORE_PASSWORD: ${{secrets.MYAPP_RELEASE_STORE_PASSWORD}}
          MYAPP_RELEASE_KEY_PASSWORD: ${{secrets.MYAPP_RELEASE_KEY_PASSWORD}}
          KEYALIAS: ${{secrets.KEY_ALIAS}}
        run: |
          echo "storeFile=../.keys/h300s.keystore" > keystore.properties
          echo "keyalias=${KEYALIAS}" >> keystore.properties
          echo "MYAPP_RELEASE_STORE_PASSWORD=${MYAPP_RELEASE_STORE_PASSWORD}" >> keystore.properties
          echo "MYAPP_RELEASE_KEY_PASSWORD=${MYAPP_RELEASE_KEY_PASSWORD}" >> keystore.properties

      - name: build
        run: ./gradlew assembleRelease

      - name: Assemble Release Bundle
        run: ./gradlew bundleRelease